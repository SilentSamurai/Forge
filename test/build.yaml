api: v1
name: Module Build
modules:
    -   name: Maven Build
        image: maven:3.8.4-jdk-8
        container: pipeline-container
        environment:
            APPLE_PIE: GOO
        steps:

            -   step: Setup Maven
                type: basic.command
                workdir: /
                command:
                    - mkdir /root/.m2

            -   step: Copy Settings Xml
                type: basic.transfer.to.container
                source: settings.xml
                destination: /root/.m2/settings.xml

            -   step: Clone Repo
                type: basic.command
                workdir: /
                command:
                    - git config --global http.sslverify false
                    - git clone https://{{ credentials.git.username }}:{{ credentials.git.token }}@github.wdf.sap.corp/SRF-AS-A-Service/SAP-Localization-Hub-Digital-Compliance-Reporting-Service.git acrscore-java -b development-next-release

            -   step: Maven Build
                type: basic.command
                workdir: /acrscore-java
                command:
                    - mvn versions:update-properties -P fin
                    - mvn clean install -Dmaven.test.skip=true -Denvironment=neo -P=neo,fin,milestone.build,snapshot.build

            -   step: Copy War
                type: basic.transfer.from.container
                source: acrscore-java/acrs-main/target/acrscore.war
                destination: root.war
